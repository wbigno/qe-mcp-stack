### QE MCP Stack - Azure DevOps Integration
### Use REST Client extension in VS Code to execute these requests
### All ADO-related endpoints (stories, defects, test plans, quality metrics)

@baseUrl = http://localhost:3000

##########################################
# AZURE DEVOPS - STORIES & WORK ITEMS
##########################################

### Pull Stories from Current Sprint (2026 Q1 Sprint 01)
POST {{baseUrl}}/api/ado/pull-stories
Content-Type: application/json

{
  "sprint": "Core\\Core Team\\2026\\Q1\\26.Q1.01"
}
###
# Sprint path format in JSON: Project\\Team\\Year\\Quarter\\Sprint
# Returns: All work items for 2026 Q1 Sprint 01

### Pull Specific Stories by ID
POST {{baseUrl}}/api/ado/pull-stories
Content-Type: application/json

{
  "workItemIds": [63145]
}

### Pull Multiple Stories
POST {{baseUrl}}/api/ado/pull-stories
Content-Type: application/json

{
  "workItemIds": [2]
}

### Analyze Requirements for Stories
POST {{baseUrl}}/api/ado/analyze-requirements
Content-Type: application/json

{
  "storyIds": [2],
  "includeGapAnalysis": true
}

### Generate Test Cases for Story
POST {{baseUrl}}/api/ado/generate-test-cases
Content-Type: application/json

{
  "storyId": 2,
  "updateADO": false
}

### Generate Test Cases and Update ADO
POST {{baseUrl}}/api/ado/generate-test-cases
Content-Type: application/json

{
  "storyId": 2,
  "updateADO": true
}

### Complete Workflow for Story
# Pulls story, analyzes requirements, generates test cases
POST {{baseUrl}}/api/ado/complete-workflow
Content-Type: application/json

{
  "storyId": 2,
  "updateADO": false
}

### Complete Workflow with ADO Update
POST {{baseUrl}}/api/ado/complete-workflow
Content-Type: application/json

{
  "storyId": 2,
  "updateADO": true
}

### Get Work Item with Analysis (Dashboard)
GET {{baseUrl}}/api/dashboard/work-item/2?analyze=true&generateTestCases=true

### Analyze Story with AI (Dashboard)
POST {{baseUrl}}/api/dashboard/analyze-story
Content-Type: application/json

{
  "storyId": 12345
}

##########################################
# DEFECT MANAGEMENT
##########################################

### Get All Defects (No Filter)
GET {{baseUrl}}/api/ado/defects
###
# Returns: All defects across all sprints

### Get Defects for Current Sprint (2026 Q1 Sprint 01)
GET {{baseUrl}}/api/ado/defects?sprint=Core%5CCore%20Team%5C2026%5CQ1%5C26.Q1.01
###
# Sprint path format: Project\Team\Year\Quarter\Sprint
# URL-encoded: Core%5CCore%20Team%5C2026%5CQ1%5C26.Q1.01
# Returns: 1 defect (ID: 63145)

### Get Dev Environment Defects
GET {{baseUrl}}/api/ado/defects?environment=Dev
###
# Filters defects with "Dev" tag

### Get UAT Environment Defects (Active Only)
GET {{baseUrl}}/api/ado/defects?environment=UAT&state=Active
###
# Filters defects with "UAT" tag and "Active" state

### Get Prod Environment Defects
GET {{baseUrl}}/api/ado/defects?environment=Prod
###
# Filters defects with "Prod" tag

### Get Defects for Sprint with Environment Filter
GET {{baseUrl}}/api/ado/defects?sprint=Core%5CCore%20Team%5C2026%5CQ1%5C26.Q1.01&environment=UAT
###
# Combines sprint and environment filters

### Get Active Defects for Current Sprint
GET {{baseUrl}}/api/ado/defects?sprint=Core%5CCore%20Team%5C2026%5CQ1%5C26.Q1.01&state=Active
###
# Filters by sprint and state

### Get Defects by Story
GET {{baseUrl}}/api/ado/defects/by-story/62967
###
# Returns defects linked to specific story (parent work item)

### Get Defect Metrics (All Sprints)
GET {{baseUrl}}/api/ado/defects/metrics
###
# Returns: metrics, byEnvironment, bySeverity, byPriority

### Get Defect Metrics for Current Sprint
GET {{baseUrl}}/api/ado/defects/metrics?sprint=Core%5CCore%20Team%5C2026%5CQ1%5C26.Q1.01
###
# Returns metrics filtered to specific sprint

##########################################
# TEST EXECUTION & TEST PLANS
##########################################

### Get All Test Plans
GET {{baseUrl}}/api/ado/test-plans

### Get Test Suites for a Plan
GET {{baseUrl}}/api/ado/test-plans/12345/suites

### Get Test Cases by Story
GET {{baseUrl}}/api/ado/test-cases/by-story/12345

### Get Test Cases for Multiple Stories
GET {{baseUrl}}/api/ado/test-cases/by-story/2

### Get All Test Runs
GET {{baseUrl}}/api/ado/test-runs

### Get Test Runs for Specific Plan
GET {{baseUrl}}/api/ado/test-runs?planId=12345

### Get Failed Test Runs
GET {{baseUrl}}/api/ado/test-runs?outcome=Failed

### Get Automated Test Runs Only
GET {{baseUrl}}/api/ado/test-runs?automated=true

### Get Manual Test Runs Only
GET {{baseUrl}}/api/ado/test-runs?automated=false

### Get Test Results for Specific Run
GET {{baseUrl}}/api/ado/test-runs/98765/results

### Get Test Execution Metrics (All Test Runs)
GET {{baseUrl}}/api/ado/test-execution/metrics
###
# Note: Test execution endpoints return graceful message if not implemented
# Returns: available=false, message="Test execution tracking not yet implemented"

### Get Test Execution Metrics for Current Sprint
GET {{baseUrl}}/api/ado/test-execution/metrics?sprint=Core%5CCore%20Team%5C2026%5CQ1%5C26.Q1.01
###
# Returns empty metrics with message about feature not yet implemented

### Get Test Execution Metrics for Sprint and Plan
GET {{baseUrl}}/api/ado/test-execution/metrics?sprint=Core%5CCore%20Team%5C2026%5CQ1%5C26.Q1.01&planId=12345
###
# Filters by both sprint and test plan ID (when implemented)

### Get Test Execution By Story (Story-Centric View)
GET {{baseUrl}}/api/ado/test-execution/by-story?sprint=Core%5CCore%20Team%5C2026%5CQ1%5C26.Q1.01
###
# Returns test execution data organized by story
# For each story, shows:
# - Story details (ID, title, state, type)
# - Test cases linked to the story
# - Per-story metrics (total cases, automation rate, pass rate)
# - Overall metrics across all stories
# Used by ADO Dashboard Test Execution tab for story-centric view

### Get Test Execution By Story (All Stories)
GET {{baseUrl}}/api/ado/test-execution/by-story
###
# Returns all stories with their test cases (no sprint filter)
# Note: May return large dataset, recommend using sprint filter

##########################################
# QUALITY METRICS & REPORTING
##########################################

### Get Overall Quality Metrics (All Data)
GET {{baseUrl}}/api/ado/quality-metrics
###
# Returns: defects, testing (with available flag), coverage, qualityScore
# Note: Test execution returns available=false if not yet implemented

### Get Quality Metrics for Current Sprint
GET {{baseUrl}}/api/ado/quality-metrics?sprint=Core%5CCore%20Team%5C2026%5CQ1%5C26.Q1.01
###
# Returns sprint-specific metrics with defects and story counts
# Testing metrics show available=false with explanation

### Get Azure DevOps Dashboard Summary (All Work Items)
GET {{baseUrl}}/api/dashboard/aod-summary
###
# Returns all work items with hierarchy (parents, children, orphans)
# Includes summary statistics

### Get ADO Summary for Current Sprint
GET {{baseUrl}}/api/dashboard/aod-summary?sprint=Core%5CCore%20Team%5C2026%5CQ1%5C26.Q1.01
###
# Returns work items for 2026 Q1 Sprint 01
# Includes parents, children, and orphan tasks

### Get ADO Summary with Sprint and State Filters
GET {{baseUrl}}/api/dashboard/aod-summary?sprint=Core%5CCore%20Team%5C2026%5CQ1%5C26.Q1.01&state=Active
###
# Filters to Active work items only

### Get ADO Summary with All Filters (Sprint, State, Environment)
GET {{baseUrl}}/api/dashboard/aod-summary?sprint=Core%5CCore%20Team%5C2026%5CQ1%5C26.Q1.01&state=Active&environment=UAT
###
# Combines sprint, state, and environment filters

##########################################
# ADO WORKFLOWS
##########################################

### Workflow 1: Story-Driven Testing
# Step 1: Pull story
POST {{baseUrl}}/api/ado/pull-stories
Content-Type: application/json

{
  "workItemIds": [2]
}

###
# Step 2: Analyze requirements
POST {{baseUrl}}/api/ado/analyze-requirements
Content-Type: application/json

{
  "storyIds": [2],
  "includeGapAnalysis": true
}

###
# Step 3: Generate test cases
POST {{baseUrl}}/api/ado/generate-test-cases
Content-Type: application/json

{
  "storyId": 2,
  "updateADO": false
}

###
# Step 4: Review in dashboard
GET {{baseUrl}}/api/dashboard/work-item/2?analyze=true

### Workflow 2: Defect Analysis by Environment
# Step 1: Get UAT defects
GET {{baseUrl}}/api/ado/defects?environment=UAT&state=Active

###
# Step 2: Get defect metrics
GET {{baseUrl}}/api/ado/defects/metrics

###
# Step 3: Review quality metrics
GET {{baseUrl}}/api/ado/quality-metrics

### Workflow 3: Test Coverage Analysis
# Step 1: Get test plans
GET {{baseUrl}}/api/ado/test-plans

###
# Step 2: Get test runs
GET {{baseUrl}}/api/ado/test-runs

###
# Step 3: Get execution metrics
GET {{baseUrl}}/api/ado/test-execution/metrics

###
# Step 4: Compare with code coverage
POST {{baseUrl}}/api/analysis/coverage
Content-Type: application/json

{
  "app": "App1",
  "detailed": true
}

### Workflow 4: Story Quality Check
# Step 1: Get story
POST {{baseUrl}}/api/ado/pull-stories
Content-Type: application/json

{
  "workItemIds": [2]
}

###
# Step 2: Get defects for story
GET {{baseUrl}}/api/ado/defects/by-story/2

###
# Step 3: Get test cases for story
GET {{baseUrl}}/api/ado/test-cases/by-story/2

###
# Step 4: Analyze story with AI
POST {{baseUrl}}/api/dashboard/analyze-story
Content-Type: application/json

{
  "storyId": 2
}

###
# Step 5: Get quality assessment
GET {{baseUrl}}/api/ado/quality-metrics?sprint=Sprint%201

### Workflow 5: Sprint Quality Report
# Step 1: Get quality metrics
GET {{baseUrl}}/api/ado/quality-metrics?sprint=Sprint%2042

###
# Step 2: Get defect breakdown
GET {{baseUrl}}/api/ado/defects?sprint=Sprint%2042

###
# Step 3: Get test execution
GET {{baseUrl}}/api/ado/test-execution/metrics?sprint=Sprint%2042

###
# Step 4: Get dashboard summary
GET {{baseUrl}}/api/dashboard/aod-summary?sprint=Sprint%2042

### Workflow 6: Story-Centric Test Coverage (NEW)
# Step 1: Get test coverage by story for current sprint
GET {{baseUrl}}/api/ado/test-execution/by-story?sprint=Core%5CCore%20Team%5C2026%5CQ1%5C26.Q1.01
###
# Returns:
# - Overall metrics: total stories, stories with/without tests, automation rate
# - Per-story breakdown: test cases linked to each story
# - Test case details: automated/manual, state, run history
# Used by ADO Dashboard Test Execution tab

###
# Step 2: Review specific story's test coverage
# Extract storyId from response above, then view in dashboard
GET {{baseUrl}}/api/dashboard/work-item/63019?analyze=true&generateTestCases=true

###
# Step 3: Compare with defects for same sprint
GET {{baseUrl}}/api/ado/defects?sprint=Core%5CCore%20Team%5C2026%5CQ1%5C26.Q1.01

###
# Step 4: Get overall quality metrics
GET {{baseUrl}}/api/ado/quality-metrics?sprint=Core%5CCore%20Team%5C2026%5CQ1%5C26.Q1.01

##########################################
# TESTING & VALIDATION
##########################################

### Quick Test - Defects Exist
GET {{baseUrl}}/api/ado/defects
###
# Expected: Success with defects array

### Quick Test - Test Plans Exist
GET {{baseUrl}}/api/ado/test-plans
###
# Expected: Success with test plans array

### Quick Test - Quality Metrics
GET {{baseUrl}}/api/ado/quality-metrics
###
# Expected: Success with quality score and metrics

### Quick Test - Sprint Data
GET {{baseUrl}}/api/ado/quality-metrics?sprint=Sprint%201
###
# Expected: Success with sprint-specific metrics

### Quick Test - ADO Dashboard Summary
GET {{baseUrl}}/api/dashboard/aod-summary?sprint=Sprint%201
###
# Expected: Success with work items and summary statistics

### Quick Test - Test Execution Metrics
GET {{baseUrl}}/api/ado/test-execution/metrics?sprint=Sprint%201
###
# Expected: Success with test execution metrics and trends

### Quick Test - Story-Centric Test Execution (NEW)
GET {{baseUrl}}/api/ado/test-execution/by-story?sprint=Core%5CCore%20Team%5C2026%5CQ1%5C26.Q1.01
###
# Expected: Success with story-organized test execution data
# Returns: metrics object with totalStories, storiesWithTests, etc.
# Returns: stories array with test cases for each story

##########################################
# ENHANCED ENDPOINTS (WITH IMPROVED ERROR HANDLING)
##########################################

### Enhanced: ADO Dashboard Summary
# Features:
# - Queries work items from Azure DevOps
# - Supports filtering by sprint, state, and environment
# - Returns work items with detailed fields and summary statistics
# - Graceful error handling - returns empty array if ADO unavailable
GET {{baseUrl}}/api/dashboard/aod-summary?sprint=Sprint%201&state=Active

### Enhanced: Quality Metrics
# Features:
# - Individual error handling for defects, test runs, and stories
# - Prevents single failure from crashing entire endpoint
# - Division by zero protection in quality score calculation
# - Graceful degradation with partial data
GET {{baseUrl}}/api/ado/quality-metrics?sprint=Sprint%201

### Enhanced: Test Execution Metrics
# Features:
# - Error handling for test runs fetch
# - Returns empty metrics if data unavailable
# - Supports sprint and planId filtering
# - Detailed error logging with stack traces
GET {{baseUrl}}/api/ado/test-execution/metrics?sprint=Sprint%201

##########################################
# ENDPOINT NOTES
##########################################

# All enhanced endpoints now include:
# ✅ Comprehensive error handling
# ✅ Graceful degradation (partial data instead of 500 errors)
# ✅ Detailed logging with context
# ✅ Stack traces in error responses for debugging
# ✅ Default values for missing/null data

# Dashboard endpoints optimized for:
# - Real-time dashboard display
# - Filtering by sprint, state, environment
# - Summary statistics and aggregations
# - Work item details with all relevant fields
