# Getting Started with QE MCP Stack

This guide will help you set up and start using the QE MCP Stack for automated testing modernization.

## Prerequisites

‚úÖ **Already have:**
- macOS
- Docker Desktop installed and running
- .NET applications at `/Users/williambigno/Desktop/git`

‚öôÔ∏è **Need to set up:**
- Azure DevOps Personal Access Token (PAT)
- Anthropic or OpenAI API key (for AI-powered test generation)

## Initial Setup

### 1. Place the Project

Move this entire `qe-mcp-stack` folder to your development directory:
```
/Users/williambigno/Dev/git/qe-mcp-stack
```

Your directory structure should look like:
```
/Users/williambigno/Dev/git/
‚îú‚îÄ‚îÄ patient-portal/
‚îú‚îÄ‚îÄ qe-mcp-stack/  ‚Üê This project
‚îî‚îÄ‚îÄ [other projects]/

OR

/Users/williambigno/Desktop/git/
‚îú‚îÄ‚îÄ app2/
‚îú‚îÄ‚îÄ app3/
‚îú‚îÄ‚îÄ app4/
‚îî‚îÄ‚îÄ qe-mcp-stack/  ‚Üê This project
```

### 2. Configure Environment Variables

**IMPORTANT:** The `.env` file goes in the **ROOT** directory, NOT in `config/`

```bash
cd /Users/williambigno/Dev/git/qe-mcp-stack

# Create .env file in ROOT directory
cp config/.env.example .env
```

Edit `.env` (in the root directory) and update:

```bash
# Required: Azure DevOps
ADO_PAT=your_actual_pat_token_here
ADO_ORG=williambigno
ADO_PROJECT=test

# Required: AI API (choose one)
ANTHROPIC_API_KEY=your_anthropic_key_here
# OR
OPENAI_API_KEY=your_openai_key_here

# Application Paths (these match docker-compose.yml mounts)
APP1_PATH=/mnt/apps/patient-portal
APP2_PATH=/mnt/apps/app2
APP3_PATH=/mnt/apps/app3
APP4_PATH=/mnt/apps/app4
```

**How to get Azure DevOps PAT:**
1. Go to Azure DevOps: https://dev.azure.com/YOUR_ORG
2. Click User Settings (top right) ‚Üí Personal Access Tokens
3. Create new token with scopes:
   - **Work Items**: Read & Write
   - **Code**: Read
4. Copy the token (you won't see it again!)

**How to get Anthropic API key:**
1. Go to: https://console.anthropic.com/
2. Create account or sign in
3. Go to API Keys
4. Create new key

### 3. Configure Applications

Edit `config/apps.json` to match your actual applications:

```json
{
  "applications": [
    {
      "name": "App1",
      "displayName": "Patient Portal",
      "path": "/mnt/apps/patient-portal",
      "localPath": "/Users/williambigno/dev/git/patient-portal",
      "type": "dotnet",
      "framework": "net8.0",
      "testFramework": "xUnit",
      "excludePaths": ["bin", "obj", "packages", "node_modules", ".vs", "TestResults"],
      "includePatterns": ["**/*.cs", "**/*.csproj"],
      "integrations": [],
      "priority": "high"
    },
    {
      "name": "App2",
      "displayName": "Financial Processing",
      "path": "/mnt/apps/app2",
      "localPath": "/Users/williambigno/Desktop/git/app2",
      "type": "dotnet",
      "framework": "net8.0",
      "testFramework": "xUnit",
      "excludePaths": ["bin", "obj", "packages", "node_modules", ".vs", "TestResults"],
      "includePatterns": ["**/*.cs", "**/*.csproj"],
      "integrations": ["Financial"],
      "priority": "high"
    }
    // ... repeat for App3, App4
  ]
}
```

**Key fields to update:**
- `name`: Internal identifier (App1, App2, etc.)
- `displayName`: Friendly name for your app
- `path`: Path inside Docker container (matches docker-compose.yml)
- `localPath`: Actual path on your Mac
- `framework`: .NET version (net8.0, net6.0, etc.)
- `integrations`: Systems your app integrates with
- `priority`: Testing priority (high, medium, low)

### 4. Configure Azure DevOps

Edit `config/ado-config.json`:

```json
{
  "organization": "your-actual-org-name",
  "project": "Your Actual Project Name",
  "apiVersion": "7.0",
  "testCase": {
    "areaPath": "Your Project Name\\Testing",
    "defaultTags": ["AutoGenerated", "QE"]
  }
}
```

### 5. Verify docker-compose.yml Paths

‚ö†Ô∏è **IMPORTANT**: The volume mounts in `docker-compose.yml` should match your `apps.json`:

```yaml
volumes:
  # These paths must match your apps.json localPath values
  - /Users/williambigno/dev/git/patient-portal:/mnt/apps/patient-portal:ro
  - /Users/williambigno/Desktop/git/app2:/mnt/apps/app2:ro
  - /Users/williambigno/Desktop/git/app3:/mnt/apps/app3:ro
  - /Users/williambigno/Desktop/git/app4:/mnt/apps/app4:ro
```

The paths should already be correct from the QUICK_FIX_GUIDE setup.

## Starting the Stack

### First Time Setup

```bash
cd /Users/williambigno/Dev/git/qe-mcp-stack

# Step 1: Make all scripts executable
chmod +x *.sh

# Step 2: Generate package-lock.json files (ONE TIME ONLY)
./generate-lockfiles.sh

# Step 3: Start the stack (this auto-creates data directories on first run)
./start.sh
```

### Option 1: Using the startup script (Recommended)

```bash
cd /Users/williambigno/Dev/git/qe-mcp-stack
./start.sh
```

This script will:
- ‚úì Check Docker is running
- ‚úì Verify .env file exists (in root, not config/)
- ‚úì Create data directories if first run
- ‚úì Verify configuration
- ‚úì Build all images
- ‚úì Start all services
- ‚úì Show you the dashboard URL

### Option 2: Manual start

```bash
cd /Users/williambigno/Dev/git/qe-mcp-stack

# First time only: setup data directories
./setup-data-dirs.sh

# Build and start
docker compose build
docker compose up -d
```

### Verify Everything is Running

```bash
docker compose ps
```

All services should show "Up". If any show "Exited", check logs:
```bash
docker compose logs service-name
```

## First Test Run

### 1. Check Health

Open browser: http://localhost:3000/health

You should see all MCPs showing "healthy" status.

### 2. Scan Your Code

```bash
curl -X POST http://localhost:3000/api/analysis/code-scan \
  -H "Content-Type: application/json" \
  -d '{"apps": ["App1"]}'
```

This will scan App1 and show:
- Total classes and methods
- Epic integration points
- Financial integration points
- Code structure

### 3. Analyze Coverage

```bash
curl -X POST http://localhost:3000/api/analysis/coverage \
  -H "Content-Type: application/json" \
  -d '{"app": "App1"}'
```

This will show:
- Current test coverage %
- Untested methods
- Missing negative tests

### 4. Pull Azure DevOps Stories

```bash
curl -X POST http://localhost:3000/api/ado/pull-stories \
  -H "Content-Type: application/json" \
  -d '{"sprint": "Sprint 45"}'
```

### 5. Run Complete Workflow

```bash
curl -X POST http://localhost:3000/api/ado/complete-workflow \
  -H "Content-Type: application/json" \
  -d '{
    "storyId": 12345,
    "updateADO": false
  }'
```

This will:
1. Pull the story from ADO
2. Analyze requirements
3. Generate test cases
4. Create automation requirements
5. Return everything as JSON (set `updateADO: true` to write back to ADO)

## Common Workflows

### Workflow 1: Analyze Test Gaps

```bash
# 1. Scan code
curl -X POST http://localhost:3000/api/analysis/code-scan -d '{"apps": ["App1"]}'

# 2. Get coverage
curl -X POST http://localhost:3000/api/analysis/coverage -d '{"app": "App1"}'

# 3. Identify gaps
curl -X POST http://localhost:3000/api/analysis/test-gaps -d '{"app": "App1"}'

# 4. Generate unit tests
curl -X POST http://localhost:3000/api/tests/generate-unit-tests -d '{"app": "App1"}'
```

### Workflow 2: Story-Driven Testing

```bash
# 1. Pull story
curl -X POST http://localhost:3000/api/ado/pull-stories -d '{"workItemIds": [12345]}'

# 2. Analyze requirements
curl -X POST http://localhost:3000/api/ado/analyze-requirements -d '{"storyIds": [12345]}'

# 3. Generate test cases
curl -X POST http://localhost:3000/api/ado/generate-test-cases -d '{"storyId": 12345}'

# 4. Create automation requirements
curl -X POST http://localhost:3000/api/ado/automation-requirements -d '{"storyId": 12345}'
```

### Workflow 3: Playwright UI Testing

```bash
# 1. Analyze critical paths
curl -X POST http://localhost:3000/api/tests/analyze-ui-paths -d '{"app": "App1"}'

# 2. Generate Playwright tests
curl -X POST http://localhost:3000/api/tests/generate-playwright-tests -d '{"app": "App1"}'

# 3. Heal broken tests
curl -X POST http://localhost:3000/api/tests/heal-playwright-tests -d '{"app": "App1"}'
```

## Viewing Logs

### All logs
```bash
docker compose logs -f
```

### Specific service
```bash
docker compose logs -f orchestrator
docker compose logs -f code-analyzer
```

### Orchestrator logs only
```bash
docker compose logs -f orchestrator
```

## Stopping the Stack

### Graceful stop
```bash
docker compose down
```

### Stop and remove volumes
```bash
docker compose down -v
```

## Troubleshooting

### Problem: Can't connect to Docker MCPs

**Solution:**
```bash
docker compose restart
# Wait 30 seconds
curl http://localhost:3000/health
```

### Problem: "Application not found" error

**Solution:** Check `config/apps.json` has the correct app name and path

### Problem: "Environment variables not set" warnings

**Solution:**
1. Verify `.env` file is in ROOT directory (not in `config/`)
```bash
ls -la .env  # Should show file in qe-mcp-stack root
cat .env     # Should show your actual values
```

2. If `.env` is in wrong location:
```bash
mv config/.env .env  # Move to root
```

### Problem: "Cannot find package-lock.json"

**Solution:** Run the lockfile generator (one time):
```bash
./generate-lockfiles.sh
docker compose build
```

### Problem: Azure DevOps connection fails

**Solution:**
1. Verify PAT token in `.env` (root directory)
2. Check organization and project names in `config/ado-config.json`
3. Ensure PAT has correct scopes (Work Items Read & Write)

### Problem: Volume mount errors on Mac

**Solution:**
1. Open Docker Desktop
2. Go to Settings ‚Üí Resources ‚Üí File Sharing
3. Add `/Users/williambigno/dev/git` and `/Users/williambigno/Desktop/git`
4. Apply & Restart

### Problem: AI-powered MCPs fail

**Solution:** Verify `ANTHROPIC_API_KEY` or `OPENAI_API_KEY` in `config/.env`

## Next Steps

1. ‚úÖ Set up the stack
2. ‚úÖ Run your first analysis
3. üìö Read [API_REFERENCE.md](docs/API_REFERENCE.md) for all endpoints
4. üîß Customize MCP configurations
5. üöÄ Integrate with your CI/CD pipeline

## Getting Help

- Check logs: `docker compose logs -f`
- Health check: http://localhost:3000/health
- MCP status: http://localhost:3000/api/mcp/status

## What's Next?

Once comfortable with the basics:
- Set up automated scheduled scans
- Integrate with your CI/CD pipeline
- Create custom dashboards
- Add more MCPs for your specific needs
