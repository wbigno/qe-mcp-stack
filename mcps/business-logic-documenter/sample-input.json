{
  "data": {
    "app": "App1",
    "className": "AppointmentService",
    "sourceCode": "public class AppointmentService\n{\n    private readonly IAppointmentRepository _repository;\n    private readonly INotificationService _notifications;\n\n    public async Task<Appointment> ScheduleAppointment(ScheduleRequest request)\n    {\n        // Business Rule: Appointments must be at least 24 hours in advance\n        if (request.DateTime < DateTime.UtcNow.AddHours(24))\n            throw new BusinessException(\"Appointments must be scheduled at least 24 hours in advance\");\n\n        // Business Rule: Provider must be available at requested time\n        var isAvailable = await _repository.CheckProviderAvailability(request.ProviderId, request.DateTime);\n        if (!isAvailable)\n            throw new BusinessException(\"Provider is not available at requested time\");\n\n        // Business Rule: Patient cannot have overlapping appointments\n        var hasConflict = await _repository.CheckPatientConflict(request.PatientId, request.DateTime);\n        if (hasConflict)\n            throw new BusinessException(\"Patient already has an appointment at this time\");\n\n        var appointment = new Appointment\n        {\n            PatientId = request.PatientId,\n            ProviderId = request.ProviderId,\n            DateTime = request.DateTime,\n            Status = AppointmentStatus.Scheduled,\n            CreatedAt = DateTime.UtcNow\n        };\n\n        await _repository.Add(appointment);\n        await _notifications.SendConfirmation(appointment);\n\n        return appointment;\n    }\n\n    public async Task<bool> CancelAppointment(int appointmentId)\n    {\n        var appointment = await _repository.GetById(appointmentId);\n        if (appointment == null)\n            return false;\n\n        // Business Rule: Cannot cancel within 2 hours of appointment\n        if (appointment.DateTime < DateTime.UtcNow.AddHours(2))\n            throw new BusinessException(\"Cannot cancel appointment within 2 hours of scheduled time\");\n\n        appointment.Status = AppointmentStatus.Cancelled;\n        appointment.CancelledAt = DateTime.UtcNow;\n\n        await _repository.Update(appointment);\n        await _notifications.SendCancellation(appointment);\n\n        return true;\n    }\n}",
    "format": "markdown"
  }
}
